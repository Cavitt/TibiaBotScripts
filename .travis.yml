# Setup environment
language: node_js
node_js: 4.2
sudo: false
cache:
  directories:
    - node_modules  
env:
  global:
  - secure: yjBjOp/7UAte8ZFqqlw6iXUjJuTcEqx9rB+/U+mfTYhkG8EfQPGw+H94zL1X10kyN1UWc4egb0aXAVWP5qHpJaxogVY7yGQgrBCtlFTPmqBNtzQf5woCFxltYYpqVE0/tn/yR1//CgFeBoPHDg8n8612dSop4Y4IjWiUdDLN9pl7uzuVlwHqo5LYUqHlMf/amp60YhsgGaKf+yia9nH0XPmAh23cdE4dpyabwaOHRMX/IS0/PYsoXaMLuj+rWOuc0NY3xCd2uFbbENdCeTt8l9bxNC1kIGFdXfAPg84Z0Ah0zxQp9OlcVDVHXtydNlLlV7LuMzbhWc9Rud0NUimIGJzacdHvVDEvKbxH9KTR00mBS2uG1G1X60Pj4kJuhReDWuRXXTNYDizex7FkIGKmTrJvPNxArzML+dJGbLsf3t9ZROeywwnSaYXr5VOu2BsEewym+ioKtQm5z2N6s8hOhY0xpHzSObH2eWxti2ehF3tUI+o4MBYMF68/lVziXi1qb5DwgpzhB7yu3xY/hCz33/1Obgro+Yc05Msb6IqaHiPCnfrnnwYhZXXMqGNlyPJ2xnidI5ADDvOQOC3UL6aMkF1/xOmGg2t6n19HLIhYJ+apKPUvx0aRuOUHded0uADE6zlhmhzl8nENbT/MAd19QSMpOBFg3hTVjqFn/M79xO4=
  - secure: dim9tPqaFkBjTAAjnsjjG/WOVo06Kn9eKvKhpWFGtdcfzYu7O1J5vqgDeLldyV8kb8NnAR42G0RqWu4ZFCBZSUQGSUTL3+eBUtrAhk/ly+xskXxyhpIEJ1DnYYBbhEY1Y8GZWHlDPeMdZ0+LLviHtvHqnsfO0ZpKrM+sObu3q9x71Ql9H+6BSjM9XYMZgt3dsGrBlmbgA1HLr/34xIixpXZRe3onhmuVONZhCUroUtMVLbn6uFDmk5hiyk6vRE5GxhWrzFH6C5ckST+FyCMVrPvEXoGl6PdosDT34uN8hodgwZ7VuDN8lJeZYKirKU0Y/2XW5klurukmiSNNBdzLUYYaBTHExyWoebmadH/jZx/40+/0xGjizsPVijTU06VcB1QW5l29WH1GUGDx+Xl7lh/VBtHNpQfGlmbwp3DnnUExPT3c6RHDKCDR6uTFVJbIgmxmj/0y+qw5xu4a/4yAOdhlckiETPcejgZ8tyXuTWxY+mMz9FhvI6Dw1+Iui4OA3giVaXYbxX+alWWZW/aSRpg7kWYQKG3oUAcS7qRpFc0G2CXzqS4Idw5eTHmfdyynNpCdQMzYhJ3ilmWn/U9QgYr/ThwH0dKihog3GqflVsU0D0FFNy2b8cN4/LXyY0jeIsFJavlFeYYlnc9SVDIMQ1r0GxijdH2qOVnn/lCMnW4=
  - secure: F4Qkes4QeteshPWMbmkpONrdvbYcDb6EWeRS5FOuem2FBE56dACh5o4HcVhdQJU5pe9sQy+4B8wtbXlzbGV56NeI4c0u9oJDWsc0aaBrXBrHApIzplET6xcIwo3592s0wSOoss0sxyB3nl6UDJ7BqqmPKesiqSRAwXlyiG4z2l4RI3Et4CetqS0vexgEHIfZB/mUb82/yRiv7EijW5cCKoAom9SwPMlJzxGtdtiGcv6w5h0TvlwmrYmObQ1r0wr2AG5PiQrksinageaqwJxwrMAci4CPmiLmWxpLUdqcO+ERvU8qoMEPy10EkvgFJMuWTwnUvvYeHmMUHTM2UqYDB7gvbEKGzbDl4NJTDPohyZVEeLIWQ6hHd4cEhO0S59N1aarH7nKU9qUdy7eFnRodO7w9Zz7If5Q5wbg4YjjKRqkxldlJP7HQqgXy6OjqWLVApnUX6UUX2APC88L0q7Sp2Y+YIXNC5rdP3HUwvQZHpJej2kDyid/hrpzZ6LU7UNXVMRU3Jkl3PeUv4+OpHdYcWUCo/lqfDq4/TQ2U/y9bqLld6u1bRKb8JpZHHNzCV2O9n+7fWsX8o6wZSHdhRkwD0js7HqrPq4rD+dV/Wrw1lJLSeOPfppu0JCusaSgT2eI8lwpYsosO/+eefH1F+IjR+1Eh5OnAOzFSK8uNwPPulSA=

# Install misc dependencies
before_install:
  - wget -O - http://www.lua.org/ftp/lua-5.1.5.tar.gz | tar xz
  - cd lua-5.1.5 && make linux local
  - export PATH=$PATH:$PWD/bin
  - cd ..

# Install node dependencies
install: npm install

# Build scripts
script: npm run build

# Deploy to script repository
after_success: npm run deploy

# Upload build artifacts
deploy:
  # Github Release
  - provider: releases
    skip_cleanup: true
    api_key:
      secure: WJskVZr0p3jVH+wDVTugDAkuZfNhXXhaQVdLdxYGRS9XWsRiHpZ+N3ez1vDCgBUxaZFV7EXpx6t56czGSbD/mi+tSxDTb8TPLnZeqSvRxncCM8W5Gy7fQrFg1U+4fNan8vZ+EeURjlfFH/1z+ed7GVPc+Y6vDXtJWxViZC0nxugY8yaoIoFqBmgN4BZyac3YV4Nk1vmlzD9jRy813XhS0JzoilKPwK8CS6PKvX5YKeODZVtPJgB0Ebz+NPWyXjpgiuinMGnUBCTRE21O6q53s0l1MKnf/fW4yzMZnsExSLqFXVx+m+aqUFTpPxaYjzuF+5ra8duPMs+2MHJUfBAzt7jBZXmJNYCe8Uaf/Zw/B1h5O80hvAKp4fRroMfzSUf/xWBMlReFh1+qee5RpbO+u8dNw8/EtGAZws/BTQku6G4j8u1cFqq21vwi/xp6YCtr0OOkE5jbhxHPqzgK+l3/Ru29+LWA2VRQjoXPWDBbKq6iAjehYGfiN9C9ZbKpeaqxd4EIiknFuGK+FZmB/qJFpiL9tYKYbrL7HCiaH9IcZEF1uE/IKme9tcPT3SEmZk891WH7l4jMZoXbt3Nt2xPGR0Jvjbs16i6BH1t8fVFIBgTJ9lyznAV71Zv1+swex1Tsk/coSaNQFuWcb6cmSeI3TdQXKvkqH5oCCCVjLPXD8zU=
    file: "./build/scripts.zip"
    on:
      tags: true

notifications:
  slack:
    on_success: always
    secure: lSNpU7Ws7C9D2EsR9EBw8axb11R8QnDjwEm+b/lXk1MoIr1BbpUMQGL8APgLb2I9/PKvLkASPC4E5yTTGYJnGhGx+QJDCP3GlAvaaSSqjoC/XMATmCLNvrLcKkZ+UmbqPF7anr7Ty7qPW3cGTeN05MS28q3GZ719o/beFGc5E/gPEXyhf5QkHeK0ynzaVhq8JEJMm5dTufjckW0HN9ZPA06L5uSouSsso1FqlicMcL1y0o3eYI+ELMvNbJGiXa9OWdRHnWmjQG1M5MCoAXan5UV2jP5Np9ouytS4GSTF5IOllaPi94KFEamBRzaLns7ck9XGxuusuMP4+HxAKizNs+q14zPo5DDwGOydjPFcWUiqJwV6Af+gnKotts9GaXCu86NpzzgQ7iwRiyBVvC4E99K9o6KyGcpbzQy/zuSXWj392dDS0JMJGIGkxnICycMS9+z/waPBt/V1u6Qx7J2wZ6aWJI7Mf7WouJnceApj+NbVRJo6hxOY4Fq37oT3CDEshp1hwW9HC3lGmROztWoV0QQNxecBcVrqPqKipXEN/0mfwN04Hwk1k6ZcJd+MbAMN5VaecIPYUs+a1nBjfwuqIEJJFsVe+UF0awGvYmru0PkJMyyy0qX2wb45b3csDEMJmGALe+Ddtx9sDnW6KJ1C17Mp/dThIazs+APrdpT9mQg=