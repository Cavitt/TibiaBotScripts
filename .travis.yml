# Setup environment
language: node_js
node_js: 4.2
sudo: false
cache:
  directories:
    - node_modules
env:
  global:
  - secure: dpD8eCOS4sawkUu6Y6BHm91I2nT1/z/Nfl8bCU0bPOVbVxwkplrORYdQAJGaC6Yy6xMfgtNO1+5pRmiwnYR6nP906TjJOkSUdxZCm7awaJoGj6IGB6slWIIerohth8+Q6bK0ITOr3Jg41SX38sDOWhkOix6mvjk1VYqcoBkWKn38gDUu/xEy/xuHIsaCgNz9VTYfPW0WwdajWxumg4LxeXW+JniPgB67DFmhnO+YwG/042+moKPGcq67HJ91e+yAwJ4z4e/swu/BdY+sg63ABCAxfJ1eviUedQfSjddXxTwJgkRuEMpjvfrGiErVzdesNNUR1O98A+BUS89y8lhsKk3Vkof20uMVKZOj+Ubc///3JGIVeIDSXv4OrdqUv0e3WYAiRmDCK3FMuLaFtkjc8trlR9Kf5w4htGE+YtheQ5YX1z20hAUsXqOBWBXnE/xJ8FfFgAxD7o0Wg22QMNQDsNAIALyUnuQfrwij8tkjnMdAVD8ber/4tyIgEy3pwS2Yf8E0UCiFeqw4F86lG4MQAbPyF2fiToTeVmkmqJPRMBOXPbAbN6Hf6I5ay9pHpY+YZ7BRPEX5Lj8y8K6omxu6cfTaLU0ul6upWfg1HRw1xaVr1OKnmaIdNxeOUUMo8RofH7WO+3goHPy0VU+th4K/DxtweJ+TLC++mneoKDtyQtM=
  - secure: z/vQV2dloYrcjmtVKC3JP6yNg2dTugQoNqy5KkjpRosj7zFQuPOCbOiODMVFlOY3sNYSo9c20uPTo80h0s2D6Ex97aQhZlEo17zQsGiK+FW+X/ccyxUzFrVmDjhT20AKRq1i9lPKC4GFy78y1UNAcqGqKwjOCFncvzq4gW/ODUk0Np6MQbxGg4k13mCFQ2pqS/508BMINEuZLzw5Y/ZBJnyG5mjundTjdRXmAdYQqqzLAn6vZn6xvlYmbIPmVgd0Nt7yrJXe1qeghrSVidF63BH9FSg11wlKDn4TxW4mA5tAZlSHta1O6Z4pxxRRzUoyHP2TXGq3qRhQOORK8JE5FtePhFUAc3yQ3uqHdM3EiHeCzc+x5S4rVwt4lWb4Q8qXg+P/L9VevlvHHBMgrJTnM0aYvOPgGwhUNzi5jd12G+SCtIUsi+k5itK7ZlANLJPfsoW+LkcoS0T/Z7nJtrU24kF3mT8jy4Wvz7lw92Qnw48t+3f9FtTIzFa/JdiAXymhfFjnexmgQbbZihFr5T5VvIcsiK0+3x5IOYCLGF7eSEydXYTOmwn3chIVFYAicKfrAC8xw/LmvMTgOXPV4h243JSET3MSLNQCQiTuTsFzy1aOxFIMo3/9xnsBp7PAZtxvvfOPUddbMAVnor77lxUmg9tgLUWMEbpQ+xwR5/35xCk=
  - secure: OFYbgksFlU87yC/K9BWAVjC5qPAE/79houoS0R/MWmdC2wefIbNkzYk2GjuUxyEZgSRrrRE0uiZi/EsaWiwuY/SsVm7Galrvm9Bo4Nl/aIX7MuzsRpbml8c72ySUMvaDlbQo5+4PW+0BAI4WjTbJx123qdTrKMjVH6zW41izu+XI2I8Fg67bjHAXxXOaT7eIN8cZrbtpvrGSgFgBIduhV/MXTpMXcSPVeyswuGGrPa3BpkEV16u4l10nDs795Hn3l20SMO+WZCvBmmfA0k0s6l1Ra3AApRYMo3Vzz+snmbBekbYyvoeL7exf7px1fJO3DytyHk1ODnDpKQGcCWJ21v5Z7sgFE9biNTItR8JgWqLNIR4FCEMeOWjeZqq+U2G8N1a5XqM/KRtF//N/qjRPEJ42CSKj0dFd28SJOI/hlGwq8pRmQuvzPeHYxQ/ZeK1KYNpzAVBlGmqZurd3l6BCj8L/OajQEfNX+T93Q+XeIxTnTtAUGqtO5s8S8sdz0EAI41dN6cylhfKSK71KX9OhAxRizLsNhE45UuCBuy31u4zPfZKlur/ro//0s+iDFUoCHfOtFbCWGEPUXGcJt6mz6gMTYNCliLaiy9Xo4ErKrIgy9HU0M9sM/OYAmTKfTAyP7Ma5dT70b40ujbG9XgGagLn8zTkZjqncub6Qw9M+pYg=

# Install misc dependencies
before_install:
  - wget -O - http://www.lua.org/ftp/lua-5.1.5.tar.gz | tar xz
  - cd lua-5.1.5 && make linux local
  - export PATH=$PATH:$PWD/bin
  - cd ..

# Install node dependencies
install: npm install

# Build scripts
script: npm run build

# Deploy to script repository
after_success: npm run deploy

# Upload build artifacts
deploy:
  # Github Release
  - provider: releases
    skip_cleanup: true
    api_key:
      secure: WJskVZr0p3jVH+wDVTugDAkuZfNhXXhaQVdLdxYGRS9XWsRiHpZ+N3ez1vDCgBUxaZFV7EXpx6t56czGSbD/mi+tSxDTb8TPLnZeqSvRxncCM8W5Gy7fQrFg1U+4fNan8vZ+EeURjlfFH/1z+ed7GVPc+Y6vDXtJWxViZC0nxugY8yaoIoFqBmgN4BZyac3YV4Nk1vmlzD9jRy813XhS0JzoilKPwK8CS6PKvX5YKeODZVtPJgB0Ebz+NPWyXjpgiuinMGnUBCTRE21O6q53s0l1MKnf/fW4yzMZnsExSLqFXVx+m+aqUFTpPxaYjzuF+5ra8duPMs+2MHJUfBAzt7jBZXmJNYCe8Uaf/Zw/B1h5O80hvAKp4fRroMfzSUf/xWBMlReFh1+qee5RpbO+u8dNw8/EtGAZws/BTQku6G4j8u1cFqq21vwi/xp6YCtr0OOkE5jbhxHPqzgK+l3/Ru29+LWA2VRQjoXPWDBbKq6iAjehYGfiN9C9ZbKpeaqxd4EIiknFuGK+FZmB/qJFpiL9tYKYbrL7HCiaH9IcZEF1uE/IKme9tcPT3SEmZk891WH7l4jMZoXbt3Nt2xPGR0Jvjbs16i6BH1t8fVFIBgTJ9lyznAV71Zv1+swex1Tsk/coSaNQFuWcb6cmSeI3TdQXKvkqH5oCCCVjLPXD8zU=
    file: "./build/scripts.zip"
    on:
      tags: true

notifications:
  slack:
    on_success: always
    secure: lSNpU7Ws7C9D2EsR9EBw8axb11R8QnDjwEm+b/lXk1MoIr1BbpUMQGL8APgLb2I9/PKvLkASPC4E5yTTGYJnGhGx+QJDCP3GlAvaaSSqjoC/XMATmCLNvrLcKkZ+UmbqPF7anr7Ty7qPW3cGTeN05MS28q3GZ719o/beFGc5E/gPEXyhf5QkHeK0ynzaVhq8JEJMm5dTufjckW0HN9ZPA06L5uSouSsso1FqlicMcL1y0o3eYI+ELMvNbJGiXa9OWdRHnWmjQG1M5MCoAXan5UV2jP5Np9ouytS4GSTF5IOllaPi94KFEamBRzaLns7ck9XGxuusuMP4+HxAKizNs+q14zPo5DDwGOydjPFcWUiqJwV6Af+gnKotts9GaXCu86NpzzgQ7iwRiyBVvC4E99K9o6KyGcpbzQy/zuSXWj392dDS0JMJGIGkxnICycMS9+z/waPBt/V1u6Qx7J2wZ6aWJI7Mf7WouJnceApj+NbVRJo6hxOY4Fq37oT3CDEshp1hwW9HC3lGmROztWoV0QQNxecBcVrqPqKipXEN/0mfwN04Hwk1k6ZcJd+MbAMN5VaecIPYUs+a1nBjfwuqIEJJFsVe+UF0awGvYmru0PkJMyyy0qX2wb45b3csDEMJmGALe+Ddtx9sDnW6KJ1C17Mp/dThIazs+APrdpT9mQg=