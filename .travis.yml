# Setup environment
language: node_js
node_js: 4.2
sudo: false
cache:
  directories:
    - node_modules  
env:
  global:
  - secure: v/voOaKQXWB7TGTxP1SmxYDPSarIAdt4OnZjMR8JnOXFJabJ6GEUkrf+5UiVHBtOJKHtaeEOOAdrVGESpmT10r7D1L+zxzfeC5pCjGAg3zu2iKFpvHl9nZccuGZ07TY/Iu4cpzTqzzpV86dai2YjMx9pPdtn3zJIjQh2xkinhZh3/Rzuf9/Bnx0oCmiNBFxxO8RB89H0b47PonJ0wzL2Nt6ApoaJ3FPrbADfAqij8oNB8CFt835iVEPN8dj8GyqJK8QWAUqiRsEbvoAH7rn55n3y9gBEDmaw44wEkFsdpI65B6YL8M0eEslo9AOSNASm2g5fv+GyghXesl3tMIC4BAk9gjwV2RMUrjxSVHOiuXGbV/XQNnkqGtoJcVgD5xdINdxvKcX0vvBS8xR1yj5uzXZrPtmcS1YMxwAfIpeL2D/d9mSI7a0AilMOLhwK5YocHwdyC0QhrJDuB7SmYRhbqvbANulvHnCkf1BNGNsuhv4WxOjJFIZEB10LlsIFX6iX1AMBTDrZlocUWqGsEC3xkMztjJt5/zF3uBDyFDdfbTsxrrIA2wLz4QDA51OU+t1VZXtvCojxj5ywMES+aw6n3rzZZTz4npIIyiddm4LfE3WHjY9l+0eL8vtQJan7KV33nSpvzBGzeig6R3vgdEg2svX0woaKIr13kE6IVeJKh/0=
  - secure: m3XMaZvfFIxbjeSqLExtyKlVQxneeZhAOAaDzxeP8tREAvQ0yFcn7kpbSdbVhO/185MynhcLWgrlOSFrBpYOqIwNOWeUu8qZhfCRr6dPsN0SZ4sAuRV1lMDcI/lOodPehDmLZQxfAIw2T8jXLINaSTIgNubjLis+grPjSnimUi841Kr9Lrv/oN1+R1D0zfTgKCW87FMOPl7Dbuyqy/5D2jRZD3iSvc2bR+EHTQV++CuY05KRojSTZOPIcuMoo6xmRm1a5DdJKrvQqX7U50uDVJebqNC+NXy/+TuVkYClzL52hvkwkHok8NYowLrUICN9ISLQdtsUI0FmzLAGhpstYHwzEfYvZf4iovcSrs/E1NnT5vcBB1CPLnmfZxzrYSFVOziGsJISHuCICwHjpRbLOaECrjDZ6CYOO2ZWFUOfrjy/rO+l76A8Tx6Hr/pgFTnur82TRjl9MvHWyXPGAgFE15lUw7mEYxGOmsP/lbtdO/HTWGm63CxtJ4BF9JE3KbLF7iPlxnf7a8DwuoDgbNX7t2APeuvDmLFbCHaxe49sQinvy22mrOdp7McWlSV3GGogT4PoiqaDtxPfmRfRaDvuEUQJbd+vPMp8Cvdru+eqnJekKXgbQpColE4ogAvDE5C4mMZYQy5TflRI2FHMostlOafhXz3xyXKKnVd7BAnoHAM=
  - secure: D3WzECBvHrthB6RsITUeyuao0sMB3Si45fZ7ws7CmvBdvU6gb4/JdaMduhCJZ8Aoo9ocbqT3JCr4kDVMPVlPsJn54TfrEpZ3pN087NDkj+3E9M+vGA8ZW+T0Gl5uPY58YDyiBCRE7tw2nRz31Tu2M3reI1nPt86DQDTvFBLyA9pyaw2/E86GyX9A/4WOCuILyL54Wamc6Y9iCNVA6IbNxv1umAd58qvxgim2baR6NCqvrNgKudZKIESVivDVWCpOP0yUMap0zXG7Bo9Q2noZATLKY4RjoGc5Dj0FD6VSsAAQwJ9+26Yy8uyHeHEULY2686azZJDxQZHoD2EZFGn0BSCLbWIciI0Upbm02yUFVcPTmchrRD/LkrRpKnFpSFgMbtCEM5Zf1DWw9KEcKWgmrE1HFJjOUTWPNmB6Slc2sP/eLXxJGlK93zCebD5x9CajN3h01Pjl4bY6Knu2ZNSMNQB4ddL1G69EhxEyhRxoZ2p8+mVhfhXbPckIgkCsS/KMJ0U/NoX+b0ZwfSdpNHxQjzsAUUl3E96FBbB0gnj3qNgKl4eqJkAzj75MjXbSww2KAyQHwVClnKLnCYT7GdGrIRZdUM5JhTU4fJAjlp4dlVVeOZf0hl5uCbyiEPhVYdrFDkQ+PML0skOxAEvWW+HW5DocKriuv5n0lEm7rSulXE0=

# Install misc dependencies
before_install:
  - wget -O - http://www.lua.org/ftp/lua-5.1.5.tar.gz | tar xz
  - cd lua-5.1.5 && make linux local
  - export PATH=$PATH:$PWD/bin
  - cd ..

# Install node dependencies
install: npm install

# Build scripts
script: npm run build

# Upload build artifacts
deploy:
  # Github Release
  - provider: releases
    skip_cleanup: true
    api_key:
      secure: WJskVZr0p3jVH+wDVTugDAkuZfNhXXhaQVdLdxYGRS9XWsRiHpZ+N3ez1vDCgBUxaZFV7EXpx6t56czGSbD/mi+tSxDTb8TPLnZeqSvRxncCM8W5Gy7fQrFg1U+4fNan8vZ+EeURjlfFH/1z+ed7GVPc+Y6vDXtJWxViZC0nxugY8yaoIoFqBmgN4BZyac3YV4Nk1vmlzD9jRy813XhS0JzoilKPwK8CS6PKvX5YKeODZVtPJgB0Ebz+NPWyXjpgiuinMGnUBCTRE21O6q53s0l1MKnf/fW4yzMZnsExSLqFXVx+m+aqUFTpPxaYjzuF+5ra8duPMs+2MHJUfBAzt7jBZXmJNYCe8Uaf/Zw/B1h5O80hvAKp4fRroMfzSUf/xWBMlReFh1+qee5RpbO+u8dNw8/EtGAZws/BTQku6G4j8u1cFqq21vwi/xp6YCtr0OOkE5jbhxHPqzgK+l3/Ru29+LWA2VRQjoXPWDBbKq6iAjehYGfiN9C9ZbKpeaqxd4EIiknFuGK+FZmB/qJFpiL9tYKYbrL7HCiaH9IcZEF1uE/IKme9tcPT3SEmZk891WH7l4jMZoXbt3Nt2xPGR0Jvjbs16i6BH1t8fVFIBgTJ9lyznAV71Zv1+swex1Tsk/coSaNQFuWcb6cmSeI3TdQXKvkqH5oCCCVjLPXD8zU=
    file: "./build/scripts.zip"
    on:
      tags: true

  # Beta Release (master)
  - provider: script
    script: deploy-beta.sh
    on:
      repo: OXGaming/oxscripts
      branch: master

  # Public Release (tagged)
  - provider: script
    script: deploy-release.sh
    on:
      repo: OXGaming/oxscripts
      tags: true

notifications:
  slack:
    on_success: always
    secure: lSNpU7Ws7C9D2EsR9EBw8axb11R8QnDjwEm+b/lXk1MoIr1BbpUMQGL8APgLb2I9/PKvLkASPC4E5yTTGYJnGhGx+QJDCP3GlAvaaSSqjoC/XMATmCLNvrLcKkZ+UmbqPF7anr7Ty7qPW3cGTeN05MS28q3GZ719o/beFGc5E/gPEXyhf5QkHeK0ynzaVhq8JEJMm5dTufjckW0HN9ZPA06L5uSouSsso1FqlicMcL1y0o3eYI+ELMvNbJGiXa9OWdRHnWmjQG1M5MCoAXan5UV2jP5Np9ouytS4GSTF5IOllaPi94KFEamBRzaLns7ck9XGxuusuMP4+HxAKizNs+q14zPo5DDwGOydjPFcWUiqJwV6Af+gnKotts9GaXCu86NpzzgQ7iwRiyBVvC4E99K9o6KyGcpbzQy/zuSXWj392dDS0JMJGIGkxnICycMS9+z/waPBt/V1u6Qx7J2wZ6aWJI7Mf7WouJnceApj+NbVRJo6hxOY4Fq37oT3CDEshp1hwW9HC3lGmROztWoV0QQNxecBcVrqPqKipXEN/0mfwN04Hwk1k6ZcJd+MbAMN5VaecIPYUs+a1nBjfwuqIEJJFsVe+UF0awGvYmru0PkJMyyy0qX2wb45b3csDEMJmGALe+Ddtx9sDnW6KJ1C17Mp/dThIazs+APrdpT9mQg=